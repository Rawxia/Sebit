<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sebit Lan Share</title>
    <link rel="icon" type="image/gif" href="favicon.gif">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        body, html { margin: 0; padding: 0; overflow: hidden; font-family: 'Press Start 2P', monospace; color: #fff; image-rendering: pixelated; height: 100%; position: relative; }
        body { background: url('sebit background.gif') no-repeat center center; background-size: cover; animation: ocean 8s linear infinite; }
        @media (max-width: 768px) { body { background: url('sebit background.gif') no-repeat center center; background-size: cover; } }
        @keyframes ocean { 0% { background-position: 0% 0; } 100% { background-position: 100% 0; } }

        .title { position: absolute; top: 20px; width: 100%; text-align: center; font-size: 18px; color: #ff77ff; text-shadow: 2px 2px #77ffff; z-index: 10; }
        .welcome { position: absolute; top: 60px; width: 100%; text-align: center; font-size: 12px; color: #77ffff; text-shadow: 1px 1px #ff77ff; z-index: 10; }

        .bubble { position: absolute; width: 32px; height: 32px; background: url('https://i.imgur.com/minecraft-bubble.png') no-repeat center/contain; image-rendering: pixelated; animation: floatUp 8s linear infinite; cursor: pointer; z-index: 5; }
        @keyframes floatUp { 0% { transform: translateY(100vh) scale(1); opacity: 0.8; } 100% { transform: translateY(-20vh) scale(1.2); opacity: 0.6; } }

        .footer { position: absolute; bottom: 10px; width: 100%; text-align: center; font-size: 10px; color: #ccc; text-shadow: 0 0 4px #000; z-index: 10; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .social-links { display: flex; gap: 15px; margin-top: 5px; }
        .social-links a { color: #77ffff; text-decoration: none; font-size: 12px; text-shadow: 1px 1px #ff77ff; transition: color 0.2s ease, text-shadow 0.2s ease; }
        .social-links a:hover { color: #ff77ff; text-shadow: 1px 1px #77ffff, 2px 2px #ff00ff; }

        #fileInput { display: none; } /* Keep fileInput hidden */

        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); display: flex; justify-content: center; align-items: center; flex-direction: column; z-index: 20; display: none; }
        .code-input, .message { background: #333; border: 2px solid #77ffff; padding: 10px; margin: 10px; font-family: 'Press Start 2P', monospace; color: #ff77ff; font-size: 16px; text-align: center; box-shadow: 0 0 10px rgba(119, 255, 255, 0.5); outline: none; width: 200px; max-width: 80%; }
        .btn { background: #007bff; border: 2px solid #0056b3; padding: 10px 20px; margin: 5px; font-family: 'Press Start 2P', monospace; color: #fff; font-size: 14px; cursor: pointer; box-shadow: 2px 2px #0056b3; transition: all 0.1s ease; text-decoration: none; }
        .btn:hover { background: #0056b3; box-shadow: 1px 1px #007bff; transform: translateY(1px) translateX(1px); }
        .status-message { position: absolute; top: 100px; width: 100%; text-align: center; font-size: 10px; color: #0f0; text-shadow: 1px 1px #000; z-index: 15; }

        #splashScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 999; opacity: 1; transition: opacity 2s ease-out; pointer-events: all; box-shadow: inset 0 0 10px 5px rgba(255, 255, 255, 0.1); }
        #splashScreen.fade-out { opacity: 0; pointer-events: none; }
        .splash-text { color: #ff00ff; font-size: 20px; text-align: center; text-shadow: 2px 2px #00ffff, 4px 4px #0000ff; margin-bottom: 20px; animation: text-flicker 0.8s infinite alternate; padding: 10px; border: 2px dashed #ff77ff; box-shadow: 0 0 15px rgba(255, 119, 255, 0.7); }
        .splash-subtext { color: #00ffff; font-size: 12px; text-align: center; text-shadow: 1px 1px #ff00ff; animation: pulse 2s infinite alternate; margin-bottom: 20px; }

        /* Updated How-To Styles */
        .how-to-use { background: rgba(0, 0, 0, 0.8); border: 2px solid #00ffff; padding: 20px; margin: 20px auto; font-size: 11px; color: #77ffff; text-shadow: 1px 1px #ff00ff; max-width: 450px; text-align: left; line-height: 1.6; box-shadow: 0 0 20px rgba(0, 255, 255, 0.5); border-radius: 8px; }
        .how-to-use h3 { text-align: center; color: #ff77ff; text-shadow: 1px 1px #00ffff; margin-top: 0; margin-bottom: 15px; font-size: 14px; }
        .how-to-use ul { list-style: none; padding: 0; margin: 0; }
        .how-to-use li { margin-bottom: 10px; }
        .how-to-use li::before { content: "â€¢ "; color: #ff77ff; font-weight: bold; display: inline-block; width: 1em; margin-left: -1em; }
        .how-to-use p { text-align: center; margin-top: 15px; font-style: italic; font-size: 10px; }

        @keyframes text-flicker { 0% { opacity: 1; text-shadow: 2px 2px #00ffff, 4px 4px #0000ff; } 50% { opacity: 0.9; text-shadow: 2px 2px #00ffff, 3px 3px #0000ff; } 100% { opacity: 1; text-shadow: 2px 2px #00ffff, 4px 4px #0000ff; } }
        @keyframes pulse { 0% { transform: scale(1); opacity: 0.8; } 100% { transform: scale(1.03); opacity: 1; } }
        #splashScreen::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: repeating-linear-gradient(#00000000 0px, #00000000 1px, rgba(0,0,0,0.1) 1px, rgba(0,0,0,0.1) 2px); pointer-events: none; z-index: 1; }

        #dropZoneOverlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 100, 200, 0.5); border: 4px dashed #77ffff; display: none; flex-direction: column; justify-content: center; align-items: center; color: #fff; font-size: 24px; text-shadow: 2px 2px #000; z-index: 998; pointer-events: none; }
        #dropZoneOverlay.active { display: flex; pointer-events: all; }
        #dropZoneOverlay .message { font-size: 18px; border: none; background: none; box-shadow: none; margin: 0; padding: 0; }
        #dropZoneOverlay .message .small-text { font-size: 14px; margin-top: 10px; }

        #progressBarContainer { position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%); width: 80%; max-width: 400px; background: #333; border: 2px solid #77ffff; box-shadow: 0 0 10px rgba(119, 255, 255, 0.5); display: none; overflow: hidden; z-index: 10; }
        .progressBar-item { margin-bottom: 5px; } /* Style for individual progress bars */
        .progressBar-item .file-name { font-size: 8px; color: #ccc; text-align: left; padding: 2px 5px; }
        .progress-bar-inner { height: 20px; width: 0%; background: linear-gradient(90deg, #0f0, #00a000); transition: width 0.1s linear; display: flex; justify-content: center; align-items: center; font-size: 10px; color: #000; text-shadow: 1px 1px #0f0; }
        #progressBarContainer.active { display: block; }

        .confetti { position: absolute; width: 10px; height: 10px; background-color: #ffeb3b; opacity: 0; animation: confetti-fall 3s ease-out forwards; pointer-events: none; z-index: 100; }
        .confetti:nth-child(2n) { background-color: #ff4081; }
        .confetti:nth-child(3n) { background-color: #00e5ff; }
        .confetti:nth-child(4n) { background-color: #7c4dff; }
        @keyframes confetti-fall { 0% { transform: translate(var(--x), var(--y)) rotate(0deg); opacity: 1; } 100% { transform: translate(var(--x), 100vh) rotate(720deg); opacity: 0; } }

        #shibaContainer { position: absolute; top: 50%; left: 0; transform: translateY(-50%); display: none; flex-direction: column; align-items: center; z-index: 8; animation: shiba-float 10s ease-in-out infinite alternate; padding: 10px; }
        #shibaContainer.active { display: flex; }
        #shibaImage { width: 64px; height: 64px; image-rendering: pixelated; margin-bottom: 5px; filter: drop-shadow(2px 2px 0px #000); }
        #shibaText { background: rgba(0, 0, 0, 0.7); border: 2px solid #ff77ff; padding: 5px 10px; font-size: 10px; color: #77ffff; text-shadow: 1px 1px #ff00ff; white-space: nowrap; animation: text-flicker 1s infinite alternate; }
        @keyframes shiba-float { 0% { transform: translate(0, -50%); } 25% { transform: translate(10vw, -45%); } 50% { transform: translate(20vw, -50%); } 75% { transform: translate(10vw, -55%); } 100% { transform: translate(0, -50%); } }

        .id-display { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; flex-direction: column; }
        #myPeerId { font-size: 18px; color: #00ffcc; text-shadow: 1px 1px #000; background: rgba(0, 0, 0, 0.5); padding: 5px 10px; border: 1px solid #00ffcc; word-break: break-all; }
        #copyIdBtn { background: #00aaff; border: 2px solid #0077cc; padding: 8px 15px; font-size: 12px; color: #fff; cursor: pointer; box-shadow: 2px 2px #0077cc; transition: all 0.1s ease; white-space: nowrap; }
        #copyIdBtn:hover { background: #0077cc; box-shadow: 1px 1px #00aaff; transform: translateY(1px) translateX(1px); }

        #readyButton { margin-top: 30px; background: #28a745; border: 2px solid #1e7e34; padding: 15px 30px; font-size: 18px; color: #fff; cursor: pointer; box-shadow: 3px 3px #1e7e34; transition: all 0.1s ease; font-family: 'Press Start 2P', monospace; }
        #readyButton:hover { background: #1e7e34; box-shadow: 2px 2px #28a745; transform: translateY(1px) translateX(1px); }

        #paperclipButtonContainer { position: fixed; top: 35%; left: 50%; transform: translate(-50%, -50%); display: none; flex-direction: column; align-items: center; z-index: 50; }
        #paperclipButton { background: rgba(0, 0, 0, 0.7); border: 2px solid #77ffff; padding: 10px; cursor: pointer; transition: transform 0.1s ease, box-shadow 0.1s ease; box-shadow: 4px 4px #000; border-radius: 5px; color: #fff; font-size: 48px; line-height: 1; user-select: none; text-align: center; display: flex; justify-content: center; align-items: center; width: 68px; height: 68px; margin-bottom: 8px; filter: drop-shadow(2px 2px 0px rgba(0, 0, 0, 0.5)); }
        #paperclipButton:hover { transform: scale(1.1); box-shadow: 2px 2px #000; }
        #paperclipText { font-size: 10px; color: #77ffff; text-shadow: 1px 1px #ff00ff; text-align: center; background: rgba(0, 0, 0, 0.6); padding: 4px 8px; border-radius: 3px; white-space: nowrap; border: 1px solid #77ffff; }

        #textTransferContainer { position: fixed; bottom: 120px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 500px; display: none; flex-direction: column; gap: 10px; z-index: 50; }
        #textInput { width: calc(100% - 24px); height: 80px; background: #333; border: 2px solid #77ffff; padding: 10px; font-family: 'Press Start 2P', monospace; color: #ff77ff; font-size: 12px; resize: vertical; box-shadow: 0 0 10px rgba(119, 255, 255, 0.5); outline: none; }
        #sendTextBtn { background: #00aaff; border: 2px solid #0077cc; padding: 8px 15px; font-size: 12px; color: #fff; cursor: pointer; box-shadow: 2px 2px #0077cc; transition: all 0.1s ease; font-family: 'Press Start 2P', monospace; align-self: flex-end; }
        #sendTextBtn:hover { background: #0077cc; box-shadow: 1px 1px #00aaff; transform: translateY(1px) translateX(1px); }
        #receivedTextDisplay { background: rgba(0, 0, 0, 0.8); border: 2px solid #ff77ff; padding: 10px; font-family: 'Press Start 2P', monospace; color: #77ffff; font-size: 12px; white-space: pre-wrap; word-wrap: break-word; max-height: 150px; overflow-y: auto; box-shadow: 0 0 10px rgba(255, 119, 255, 0.5); margin-top: 10px; display: none; }

        #pasteIdBtn { background: #ffc107; border: 2px solid #e0a800; padding: 10px 20px; margin: 5px; font-family: 'Press Start 2P', monospace; color: #333; font-size: 14px; cursor: pointer; box-shadow: 2px 2px #e0a800; transition: all 0.1s ease; white-space: nowrap; }
        #pasteIdBtn:hover { background: #e0a800; box-shadow: 1px 1px #ffc107; transform: translateY(1px) translateX(1px); }

        #qrcode { margin-top: 15px; display: flex; justify-content: center; align-items: center; padding: 10px; background-color: #fff; border: 2px solid #77ffff; box-shadow: 0 0 10px rgba(119, 255, 255, 0.5); }

        /* Media queries for responsiveness */
        @media (max-width: 768px) {
            .title { font-size: 14px; }
            .welcome { font-size: 10px; }
            .code-input, .message { font-size: 14px; }
            .btn, #pasteIdBtn { font-size: 12px; padding: 8px 15px; }
            .status-message { top: 70px; font-size: 8px; }
            .splash-text { font-size: 16px; }
            .splash-subtext { font-size: 10px; }
            .how-to-use { font-size: 9px; padding: 15px; max-width: 300px; }
            .how-to-use h3 { font-size: 12px; }
            .how-to-use li { margin-bottom: 8px; }
            .how-to-use p { font-size: 8px; }
            #readyButton { padding: 10px 20px; font-size: 14px; }
            #myPeerId { font-size: 14px; }
            #shibaImage { width: 48px; height: 48px; }
            #shibaText { font-size: 8px; }
            .footer { font-size: 8px; }
            .social-links a { font-size: 10px; }
            #paperclipButton { font-size: 36px; padding: 8px; width: 52px; height: 52px; }
            #paperclipText { font-size: 8px; }
            #paperclipButtonContainer { top: 30%; }
            #textTransferContainer { bottom: 80px; width: 95%; }
            #textInput, #receivedTextDisplay { font-size: 10px; height: 60px; }
            #sendTextBtn { font-size: 10px; padding: 6px 10px; }
            #qrcode { width: 100px; height: 100px; margin-left: auto; margin-right: auto; }
        }
    </style>
</head>

<body>
    <div id="splashScreen">
        <div class="splash-text">Welcome to Sebit P2P File Transfer!</div>
        <div class="splash-subtext">This is still in Alpha and Work in Progress but focused with privacy in mind.</div>
        <div class="how-to-use">
            <h3>Quick How-To:</h3>
            <ul>
                <li>1. Open on two devices to begin.</li>
                <li>2. One person shares their Unique ID.</li>
                <li>3. The other person enters that ID or uses the **Paste ID** button and clicks "Connect".</li>
                <li>4. Once connected, drag & drop files or folders anywhere on the page to send.</li>
                <li>5. Or, click the ðŸ“Ž icon to browse and attach files!</li>
                <li>6. **NEW!** Send text messages for easy copy & paste.</li>
            </ul>
            <p>(Connection status will be displayed below.)</p>
        </div>
        <button id="readyButton">Ready!</button>
    </div>

    <div class="title">ðŸŒŠ Sebit Lan Share ðŸŒŠ</div>
    <div class="welcome">Welcome to Seb P2P LAN sharer!</div>
    <div class="status-message" id="statusMessage">Connecting to signaling server...</div>

    <div class="overlay" id="roomOverlay">
        <div class="message">
            <p>Your unique ID:</p>
            <div class="id-display">
                <span id="myPeerId"></span>
                <button id="copyIdBtn" class="btn">Copy ID</button>
                <div id="qrcode"></div> </div>
            <p>Share this ID for others to connect, or enter an ID below:</p>
        </div>
        <input type="text" id="roomCodeInput" class="code-input" placeholder="Enter peer ID to connect" maxlength="36">
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;">
            <button id="connectBtn" class="btn">Connect</button>
            <button id="pasteIdBtn" class="btn">Paste ID</button>
            <button id="newIdBtn" class="btn">Generate New ID</button>
        </div>
    </div>

    <div id="dropZoneOverlay">
        <div class="message">
            <p>Drag and drop your files or folders here to send!</p>
            <p class="small-text">(Files will be sent to your connected device)</p>
        </div>
    </div>

    <div id="progressBarContainer"></div> <div id="shibaContainer">
        <img id="shibaImage" src="shiba.gif" alt="8-bit Shiba Inu">
        <div id="shibaText">This Shiba Inu is your other device!</div>
    </div>

    <div id="paperclipButtonContainer">
        <button id="paperclipButton">ðŸ“Ž</button>
        <div id="paperclipText">Drag & drop files or click to attach</div>
    </div>

    <div id="textTransferContainer">
        <textarea id="textInput" placeholder="Type message to send..."></textarea>
        <button id="sendTextBtn">Send Text</button>
        <div id="receivedTextDisplay" title="Click to copy received text"></div>
    </div>

    <div class="footer">
        Created by Rawxia - Privacy in mind
        <div class="social-links">
            <a href="https://www.instagram.com/sebulique/" target="_blank" rel="noopener noreferrer">Instagram</a>
            <a href="https://www.youtube.com/@6_LN" target="_blank" rel="noopener noreferrer">YouTube</a>
        </div>
    </div>
    <input type="file" id="fileInput" multiple webkitdirectory directory />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/peerjs.min.js"></script>

    <script>
        const DOM = {
            splashScreen: document.getElementById('splashScreen'),
            readyButton: document.getElementById('readyButton'),
            statusMessage: document.getElementById('statusMessage'),
            roomOverlay: document.getElementById('roomOverlay'),
            myPeerId: document.getElementById('myPeerId'),
            roomCodeInput: document.getElementById('roomCodeInput'),
            connectBtn: document.getElementById('connectBtn'),
            pasteIdBtn: document.getElementById('pasteIdBtn'),
            copyIdBtn: document.getElementById('copyIdBtn'),
            newIdBtn: document.getElementById('newIdBtn'),
            dropZoneOverlay: document.getElementById('dropZoneOverlay'),
            progressBarContainer: document.getElementById('progressBarContainer'),
            shibaContainer: document.getElementById('shibaContainer'),
            paperclipButtonContainer: document.getElementById('paperclipButtonContainer'),
            paperclipButton: document.getElementById('paperclipButton'),
            fileInput: document.getElementById('fileInput'),
            textTransferContainer: document.getElementById('textTransferContainer'),
            textInput: document.getElementById('textInput'),
            sendTextBtn: document.getElementById('sendTextBtn'),
            receivedTextDisplay: document.getElementById('receivedTextDisplay')
        };

        let peer, conn;
        const receivedFiles = {};

        // --- Utility Functions ---
        const setStatusMessage = (message, type = 'info') => {
            DOM.statusMessage.textContent = message;
            DOM.statusMessage.style.color = type === 'error' ? '#f00' : (type === 'success' ? '#0f0' : '#0ff');
        };

        const generateQrCode = (text) => {
            const qrcodeContainer = document.getElementById("qrcode");
            qrcodeContainer.innerHTML = ""; // Clear existing QR
            new QRCode(qrcodeContainer, { text, width: 128, height: 128, colorDark: "#000000", colorLight: "#ffffff", correctLevel: QRCode.CorrectLevel.H });
        };

        const toggleTransferUI = (show) => {
            DOM.paperclipButtonContainer.style.display = show ? 'flex' : 'none';
            DOM.textTransferContainer.style.display = show ? 'flex' : 'none';
        };

        const createProgressBar = (filename) => {
            DOM.progressBarContainer.classList.add('active');
            const item = document.createElement('div');
            item.className = 'progressBar-item';
            item.innerHTML = `<div class="file-name">${filename}</div><div class="progress-bar-inner">0%</div>`